<!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>NDP 2020</title>
        <script src="JS/main.js"></script>
        <link rel="stylesheet" type="text/css" href="CSS/main.css">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;1,100&display=swap" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/moment.min.js"></script>
    </head>

    <body class="screen">
        <div class="mainPageContainer">
            <h1 style="color: #379683" align="center">CONTENT COMMITTEE CHECKLIST <i class="fa fa-check-square-o" aria-hidden="true"></i></h1>
            <p class="bold">Congratulations, on finishing your edit!</p>
            <p class="regular">Now it's time to render, before your do please make sure you've done the following:</p>
            <br>
            <div id="page1">
                <p class="bold">I'm Creating Content For:</p>
                <select onchange="checkWhichSelection();" id="selectCompany" class="selectForm">
                    <option value="NIL">
                        Please pick an option
                    </option>
                    <option value="showCompany">
                        Show Company (For the LED Screens (K1-5, F1-2))
                    </option>
                    <option value="hexagon">
                        Hexagon (For the projection panel)
                    </option>
                </select>
                <br><br>
                <div id="showCompany" style="display: none;">
                    <p class="bold">Checklist <i class="fa fa-check-square-o" aria-hidden="true"></i></p>
                    <ul id="showCompanyCheck" class="parent1">
                        <li>File Format: .mov</li>
                        <li>codec: dxv2</li>
                        <li>FPS: 25</li>
                        <li>Your resolution is correct (Double check it matches your respective screen)</li>
                    </ul>
                    <br><br>
                </div>
                <div id="hexagon" style="display: none;">
                    <p class="bold">Checklist <i class="fa fa-check-square-o" aria-hidden="true"></i></p>
                    <ul id="hexagonCheck" class="parent2">
                        <li>File Format: .mov</li>
                        <li>codec: hap</li>
                        <li>FPS: 25</li>
                        <li>Your resolution is correct (double check your instructions)</li>
                    </ul>
                    <br><br>
                </div>
                <button onclick="nextPage();" style="display: none" id="formButton" class="formButton">NEXT</button>
            </div>
            <div id="page2" style="display: none;">

                <p class="bold">CONFIGURE FILE NAME</p>
                <p class="light" style="margin: 0">Choose Load-In Time</p>
                <select onchange="checkLoadInSelection()" id="selectLoadIn" class="selectForm">
                     <option value="NIL">Choose an option</option>
                     <option value="Auto">Automatically Choose The Nearest Load-In Time</option>
                    <option value="ProductionHouse">PRODUCTION HOUSE OPTION</option>
                     <option value="1000">1000</option>
                     <option value="1200">1200</option>
                     <option value="1500">1500</option>
                     <option value="1700">1700</option>
                     <option value="1900">1900</option>
                 </select>
                <br><br>

                <div id="videoResolutionChooser" style="display: none;">
                    <p class="light" style="margin: 0">Choose Video Resolution</p>
                    <select id="selectCustom" class="selectForm" onchange="customOrNot();">
                        <optgroup label="LED">
                            <option value="Fixed">Fixed Resolution (Height x1280)</option>
                            <option value="Full">Full Resolution (Height x2560)</option>
                        </optgroup>
                        <optgroup label="MEDIA CORP">
                            <option value="MediaCorp">Media Corp (16:9)</option>
                        </optgroup>
                        <optgroup label="PROJECTION">
                            <option value="Projection">Projection</option>
                        </optgroup>
                        <option value="Custom">Custom</option>
                    </select>
                    <br><br>
                    <select multiple onchange="checkResolution()" id="selectResolution" class="selectForm">
                        <optgroup label="LED SCREENS">
                            <option value="K1">Screen K1</option>
                            <option value="K2">Screen K2</option>
                            <option value="K3">Screen K3</option>
                            <option value="K4">Screen K4</option>
                            <option value="K5">Screen K5</option>
                            <option value="F1">Screen F1</option>
                            <option value="F2">Screen F2</option>
                        </optgroup>
                    </select>
                    <select multiple onchange="checkResolution()" id="selectResolutionProj" class="selectForm">
                        <optgroup label="PROJECTION">
                            <option value="PROJL">PROJECTION LEFT</option>
                            <option value="PROJR">PROJECTION RIGHT</option>
                            <option value="PROJC">PROJECTION CENTER</option>
                            <option value="KABUKI">KABUKI</option>
                        </optgroup>
                    </select>
                    <p style="color: red; margin: 0;" class="light" id="configurationErr">Screen Configuration Is Invalid</p>
                    <div id="customResolution" style="text-align: center;display: none;">
                        <input onchange="getCustomResolution();" placeholder="Width" id="width" style="display: inline-block; width: 30%" class="inputFocus" >
                        <label class="regular">&nbsp;&nbsp;x&nbsp;&nbsp;</label>
                        <input onchange="getCustomResolution();" placeholder="Height" id="height" style="display: inline-block; width: 30%" class="inputFocus" >
                    </div>
                </div>
                <br><br>
                <div id="filenameChooser" style="display: none;">
                    <p class="light" style="margin: 0;">(OPTIONAL) File Extension:</p>
                    <select onchange="checkFileName()" id="selectExtension" class="selectForm">
                        <option value="">Optional Additional File Extensions</option>
                        <optgroup label="UN-ENCODED">
                            <option value="_unencoded">PRODUCTION HOUSE</option>
                            <option value="_SUB_unencoded">SUBTITLES</option>
                            <option value="_LTLEFT_unencoded">LOWER THIRDS LEFT</option>
                            <option value="_LTRIGHT_unencoded">LOWER THIRDS RIGHT</option>
                            <option value="_LT_unencoded">LOWER THIRDS</option>
                            <option value="_FILMTITLE_unencoded">FILM TITLES</option>
                        </optgroup>
                        <optgroup label="ENCODED">
                            <option value="">PRODUCTION HOUSE</option>
                            <option value="_SUBHAP">SUBTITLES</option>
                            <option value="_LTLEFTHAP">LOWER THIRDS LEFT</option>
                            <option value="_LTRIGHTHAP">LOWER THIRDS RIGHT</option>
                            <option value="_LTHAP">LOWER THIRDS</option>
                            <option value="_FILMTITLE">FILM TITLES</option>
                        </optgroup>
                    </select>
                    <p class="light" style="margin: 0;">File Name:</p>
                    <select onchange="checkFileName()" id="selectFileName" class="selectForm">
                        <option value="NIL">Choose an option</option>
                        <option value="Custom">Custom Filename</option>
                        <optgroup label="Performances">
                            <option value="P0">P0 House is not a home</option>
                            <option value="P1">P1 Overture</option>
                            <option value="P2">P2 CB Life in the Lion City</option>
                            <option value="P3">P3 Each Other</option>
                            <option value="P4.1">P4.1 Gymnopedie I</option>
                            <option value="P4.2">P4.2 Gymnopedie II</option>
                            <option value="P5">P5 Together</option>
                            <option value="P6">P6 Stay With You (JJ + Stef)</option>
                            <option value="P7">P7 Queenfisher</option>
                            <option value="P8">P8 Everything I Am</option>
                            <option value="P9">P9 Everyday Heroes</option>
                            <option value="P10">P10	We Will Get There</option>
                            <option value="P11.1">P11.1 Reprise 1</option>
                            <option value="P11.2">P11.2 Reprise 1</option>
                            <option value="P11.3">P11.3 Virtual Choir</option>
                            <option value="P12.1">P12.1 Finale Pledge</option>
                            <option value="P12.2">P12.2 Finale Anthem</option>
                            <option value="P13">P13 Fireworks and Lightup</option>
                        </optgroup>
                        <optgroup label="Show Films">
                            <option value="Film2">Film 2</option>
                            <option value="Film4">Film 4</option>
                            <option value="Film5A">Film 5A</option>
                            <option value="Film5B">Film 5B</option>
                            <option value="Film6">Film 6</option>
                            <option value="Film7">Film 7</option>
                            <option value="Film8">Film 8</option>
                            <option value="Film9">Film 9</option>
                        </optgroup>
                    </select>
                    <input style="display: none" onchange="generateCopyText();" class="inputFocus" id="filename" >
                    <br><br>
                    <div style="text-align: center;">
                        <a class="link" href="javascript:copyTextFunc();"><label style="cursor: pointer" id="copyText" class="light">Choose/Type File name...</label> &nbsp;<i class="fa fa-clipboard" aria-hidden="true"></i></a>
                        <em><p class="light" id="copied">&nbsp;</p></em>
                    </div>
                </div>

                <br><br>
                <button onclick="refresh();" class="formButton">New Render</button>
                <input id="copy" style="display: none;">
            </div>
        </div>
    </body>

    <script>
        var resolution = {
        	K1: {
        		number:1,
        		width:1024,
                height:1280,
            },
            K2:{
	            number:2,
	            width:768,
	            height:1280,
            },
            K3:{
	            number:3,
	            width:1792,
	            height:1280,
            },
            K4:{
	            number:4,
	            width:768,
	            height:1280,
            },
            K5:{
	            number:5,
	            width:1024,
	            height:1280,
            },
            F1:{
	            number:8,
	            width:1024,
	            height:1792,
            },
            F2:{
	            number:10,
	            width:1280,
	            height:768,
            },
	        PROJL:{
		        number:12,
		        width:972,
		        height:1888,
	        },
	        PROJR:{
		        number:14,
		        width:972,
		        height:1888,
	        },
	        PROJC:{
		        number:16,
		        width:3840,
		        height:1068,
	        },
            KABUKI:{
	            number:18,
	            width:2664,
	            height:1440,
            }
        }
	    // Add a "checked" symbol when clicking on a list item
	    var list1 = document.getElementById('showCompanyCheck');
	    list1.addEventListener('click', function(ev) {
		    if (ev.target.tagName === 'LI') {
			    ev.target.classList.toggle('checked');
		    }
	    }, false);

        var list2 = document.getElementById('hexagonCheck');
        list2.addEventListener('click', function(ev) {
	        if (ev.target.tagName === 'LI') {
		        ev.target.classList.toggle('checked');
	        }
        }, false);

	    function checkWhichSelection(){

		    if( $('#selectCompany').val() === 'showCompany' ){
			    $('#showCompany').fadeIn();
			    $('#hexagon').hide();
			    $('#formButton').show();
		    }
		    else if( $('#selectCompany').val() === 'hexagon' ){
			    $('#hexagon').fadeIn();
			    $('#showCompany').hide();
			    $('#formButton').show();
		    }
		    else{
			    $('#showCompany').hide();
			    $('#hexagon').hide();
			    $('#formButton').hide();
		    }

	    }
	    function checkLoadInSelection(){
		    if( $('#selectLoadIn').val() !== 'NIL' ){
			    $('#videoResolutionChooser').show();
			    $("#selectResolutionProj").hide();
		    }
		    if($("#selectFileName").val()!=="NIL"){
			    checkFileName()
            }
	    }
	    function customOrNot() {
		    if($("#selectCustom").val()==="Fixed" || $("#selectCustom").val()==="Full"){
			    $("#selectResolution").show()
			    $("#customResolution").hide();
			    $("#selectResolutionProj").hide();
		    }
		    else if($("#selectCustom").val()==="Custom"){
			    $("#selectResolution").hide()
			    $("#customResolution").show();
			    $("#configurationErr").hide()
			    $("#selectResolutionProj").hide();
                if($("#width").val().length !==0 && $("#height").val().length !==0){
                	$("#filenameChooser").show();
                }
		        else{
	                $("#filenameChooser").hide();
                }
		    }
		    else if($("#selectCustom").val()==="Projection"){
			    $("#selectResolution").hide()
			    $("#customResolution").hide();
			    $("#selectResolutionProj").show();
            }
		    else if($("#selectCustom").val()==="MediaCorp"){
			    $("#selectResolution").hide()
			    $("#customResolution").hide();
			    $("#selectResolutionProj").hide();
			    $("#filenameChooser").show();
            }
		    checkFileName();
	    }
        function checkResolution(){
	    	if($("#selectCustom").val()==="Fixed" || $("#selectCustom").val()==="Full"){
			    console.log($("#selectResolution").val())
			    var resolutionArray = []
			    var linearSequence = []
			    for(var i=0; i<$("#selectResolution").val().length; i++){
				    resolutionArray.push(resolution[$("#selectResolution").val()[i]])
				    linearSequence.push(resolution[$("#selectResolution").val()[i]].number)
			    }
			    console.log(resolutionArray)
			    console.log(linearSequence)
			    console.log(checkLinear(linearSequence))
			    if(checkValidityOfConfiguration(linearSequence, resolutionArray)){
				    $("#configurationErr").hide()
				    $("#filenameChooser").show()
			    }
			    else{
				    $("#configurationErr").show()
				    $("#filenameChooser").hide()
			    }
            }
            else if($("#selectCustom").val()==="Projection"){
			    $("#filenameChooser").show()
			    $("#configurationErr").hide()
                getResolution()
            }
            if($("#selectFileName").val()!=="NIL"){
	            checkFileName()
            }
        }
        function getSequenceArray(){
	        console.log($("#selectResolution").val())
	        var resolutionArray = []
	        var linearSequence = []
	        for(var i=0; i<$("#selectResolution").val().length; i++){
		        resolutionArray.push(resolution[$("#selectResolution").val()[i]])
		        linearSequence.push(resolution[$("#selectResolution").val()[i]].number)
	        }
	        return ([resolutionArray,linearSequence])
        }
	    function checkFileName(){
            if($("#selectFileName").val()==="Custom"){
            	$("#filename").show()
	            resetCopyText();
            }
            else{
	            resetCopyText();
	            $("#filename").hide()
                if($("#selectFileName").val()!=="NIL" && $("#selectCustom").val()!=="Projection"){
	                $("#copyText").html(
		                $('#selectFileName').val()+"_"+
		                getResolution()[0]+"x"+
		                getResolution()[1]+
		                '_v'+
		                getNearestTimeStamp()+
		                $("#selectExtension").val()
                    )
                }
                else if($("#selectFileName").val()!=="NIL" && $("#selectCustom").val()==="Projection"){
	                $("#copyText").html(
		                $('#selectFileName').val()+"_"+
                        $('#selectResolutionProj').val()+"_"+
		                getResolution()[0]+"x"+
		                getResolution()[1]+
		                '_v'+
		                getNearestTimeStamp()+
		                $("#selectExtension").val()
	                )
                }

            }
	    }
	    function getNearestTimeStamp(){
	    	var YYYYMMDD = moment(new Date()).format("YYYYMMDD");

	    	if(parseInt(moment(new Date()).format('HHmm')) > closestLoadIn($("#selectLoadIn").val()) ){
			    var new_date = moment(new Date()).add(1, 'days');
			    YYYYMMDD = moment(new_date).format("YYYYMMDD")
		    }
	    	return(YYYYMMDD + closestLoadIn($("#selectLoadIn").val()).toString())
        }
        function closestLoadIn(data){
	    	var LoadIns = [1000, 1200, 1500, 1700, 1900]
            var closestIndex = 0;
	    	if(data==="Auto"){
	    		var currentTime = parseInt(moment(new Date()).format("HHmm"))
			    for(var i =LoadIns.length-1; i>0; i--){
			    	if(currentTime < LoadIns[i]){
					    closestIndex = i
                    }
                }
	    	    return LoadIns[closestIndex]
            }
	    	else if(data ==="ProductionHouse"){
	    		return(parseInt(moment(new Date()).format("HHmm")))
            }
	    	else{
	    		return parseInt(data)
            }
        }
        function getResolution(){
	    	var width = parseInt($("#width").val());
	    	var height= parseInt($("#height").val());
	    	if($("#selectCustom").val()==="Fixed" || $("#selectCustom").val()==="Full"){
			    width = 0
                height = getSequenceArray()[0][0].height
			   if(checkLinear(getSequenceArray()[1])){
				   for(var i =0; i<getSequenceArray()[0].length; i++){
					   width = width + getSequenceArray()[0][i].width
                   }
				   width = width + 20*(getSequenceArray()[0].length-1)
                   if($("#selectCustom").val()==="Full"){
                   	height = height*2;
                   }
				   return [width, height]
               }
			   else{
				   for(var i =0; i<getSequenceArray()[0].length/2; i++){
					   width = width + getSequenceArray()[0][i].width
				   }
				   width = width + 20*((getSequenceArray()[0].length/2)-1)
				   return [width, height]
               }
            }
	    	if($("#selectCustom").val()==="MediaCorp"){
	    		width = 1920
                height = 1080
			    return [width, height]
            }
	    	if($("#selectCustom").val()=="Projection"){
	    		width = resolution[$("#selectResolutionProj").val()].width
                height = resolution[$("#selectResolutionProj").val()].height
			    return [width, height]
            }
	    	return [width, height]
        }
        function getCustomResolution(){
	    	if($("#width").val().length !== 0 && $("#height").val().length !== 0){
	    		$("#filenameChooser").show()
			    checkFileName();
            }
        }

	    function checkValidityOfConfiguration(array, JsonArray){
	    	if(array.length!==0){
			    if(!checkLinear(array)){
				    if(array.length%2===0 && !array.includes(8) && !array.includes(10) && !array.includes(12) && !array.includes(14) && !array.includes(16) && !array.includes(18)){
				    	var validOrNot = true;
				    	for(var i =0; i<array.length/2; i++){
				    		if(JsonArray[i].width !== JsonArray[array.length-1-i].width){
							    validOrNot = false;
                            }
                        }
					    return validOrNot;
				    }
				    else{
					    return false;
				    }
			    }
			    else{
				    return true
			    }
            }
	    	else{
	    		return false
            }
        }
        function checkLinear(array){
	    	var commonDiff = 1;
	    	var newCommonDiff =0;
	    	if(array.length >=2){
			    for(var i=0; i<array.length-1; i++){
				    newCommonDiff = array[i+1]-array[i]
                    if(commonDiff!==newCommonDiff){
                    	return false
                    }
			    }
			    return true
            }
	    	else{
	    		if(array.length >= 0){
				    return true
                }
	    		else{
	    			return false
                }
            }

        }
	    function nextPage(){
		    let parent1 = document.querySelector(".parent1"),
			    parent2 = document.querySelector(".parent2");
		    if($('#selectCompany').val() === 'showCompany'){
			    if (parent1.children.length == parent1.querySelectorAll(".checked").length) {
				    $('#page1').hide();
				    $('#page2').fadeIn();
			    }
			    else{
				    Swal.fire({
					    icon: 'error',
					    title: 'Oops...',
					    text: 'Please make sure you\'ve configured the files properly',
				    })
			    }
		    }
		    if($('#selectCompany').val() === 'hexagon'){
			    if (parent2.children.length == parent2.querySelectorAll(".checked").length) {
				    $('#page1').hide();
				    $('#page2').fadeIn();
			    }
			    else{
				    Swal.fire({
					    icon: 'error',
					    title: 'Oops...',
					    text: 'Please make sure you\'ve configured the files properly',
				    })
			    }
		    }
	    }
	    function refresh(){
		    location.reload();
	    }
	    function generateCopyText(){
		    $("#copyText").html(
			    $('#filename').val().toUpperCase()+"_"+
			    getResolution()[0]+"x"+
			    getResolution()[1]+
			    '_v'+
			    getNearestTimeStamp()
		    )
	    }
	    function resetCopyText(){
		    $("#copyText").html("Choose/Type File name...")

	    }
	    function copyTextFunc(){
		    $('#copy').show();
		    $('#copy').val($('#copyText').html())
		    var copyText = document.getElementById("copy");
		    copyText.select();
		    copyText.setSelectionRange(0, 99999)
		    document.execCommand("copy");
		    $('#copied').hide();
		    $('#copied').fadeIn();
		    $('#copied').html('Copied!<i class="fa fa-check" aria-hidden="true"></i></p>')
		    $('#copy').hide();
	    }
    </script>
</html>
